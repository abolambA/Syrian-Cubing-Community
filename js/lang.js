const translations = {
    en: {
        title_landing: "Cubing Competition Leaderboard",
        select_event: "Event:",
        event_3x3: "3x3 Cube", // Add more event names here
        switch_language: "العربية",
        admin_login: "Admin Login",
        main_title: "Competition Leaderboard",
        status_loading: "Status: Loading...",
        status_not_started: "Not Started",
        status_in_progress: "In Progress",
        status_finished: "Finished",
        podium_title: "Podium",
        leaderboard_title: "Full Leaderboard",
        rank: "Rank",
        name: "Name",
        average: "Average",
        solves: "Solves",
        footer_text: "© 2025 Cubing Competition",
        // Admin Page
        title_admin: "Admin Panel - Cubing Competition",
        view_leaderboard: "View Leaderboard",
        admin_panel_title: "Admin Panel",
        round_status_title: "Round Status Control",
        current_status_label: "Current Status:",
        update_status_btn: "Update Status",
        competitor_management_title: "Competitor Management",
        add_competitor_btn: "Add New Competitor",
        existing_competitors_title: "Existing Competitors",
        add_results_btn: "Add Results",
        delete_competitor_btn: "Delete",
        admin_login_prompt: "Admin Login Required",
        login_btn: "Login",
        // Add Competitor Page
        title_add_competitor: "Add Competitor - Admin Panel",
        back_to_admin: "Back to Admin Panel",
        add_competitor_title: "Add New Competitor",
        competitor_name_label: "Competitor Name:",
        competitor_photo_label: "Profile Picture:",
        submit_competitor_btn: "Add Competitor",
        // Add Results Page
        title_add_results: "Add Results - Admin Panel",
        add_results_title: "Add Results",
        adding_results_for: "Adding results for: ",
        enter_solves_label: "Enter 5 Solves (use 'DNF' for Did Not Finish):",
        calculated_ao5_label: "Calculated Average of 5:",
        ao5_calculating: "Calculating...",
        submit_results_btn: "Submit Results",
        // JS Messages
        status_updated: "Status updated successfully!",
        status_update_failed: "Failed to update status.",
        competitor_added: "Competitor added successfully!",
        competitor_add_failed: "Failed to add competitor.",
        results_added: "Results added successfully!",
        results_add_failed: "Failed to add results.",
        competitor_deleted: "Competitor deleted successfully!",
        competitor_delete_failed: "Failed to delete competitor.",
        confirm_delete: "Are you sure you want to delete this competitor?",
        login_failed: "Login failed. Please try again.",
        invalid_credentials: "Invalid email or password.", // New
        invalid_email_format: "Invalid email format.", // New
        logout_btn: "Logout",
        invalid_time_format: "Invalid time format. Use seconds (e.g., 12.34) or DNF.",
        need_5_solves: "Please enter exactly 5 solves.",
        photo_upload_failed: "Photo upload failed.",
        photo_uploaded: "Photo uploaded successfully.",
        fetching_data: "Fetching data...",
        no_competitors: "No competitors added yet.",
        no_results: "No results yet."
    },
    ar: {
        title_landing: "لوحة صدارة مسابقة التكعيب",
        select_event: "الحدث:",
        event_3x3: "مكعب 3x3", // Add more event names here
        switch_language: "English",
        admin_login: "دخول المسؤول",
        main_title: "لوحة صدارة المسابقة",
        status_loading: "الحالة: جاري التحميل...",
        status_not_started: "لم تبدأ بعد",
        status_in_progress: "قيد التنفيذ",
        status_finished: "انتهت",
        podium_title: "منصة التتويج",
        leaderboard_title: "لوحة الصدارة الكاملة",
        rank: "الترتيب",
        name: "الاسم",
        average: "المتوسط",
        solves: "المحاولات",
        footer_text: "© 2025 مسابقة التكعيب",
        // Admin Page
        title_admin: "لوحة التحكم للمسؤول - مسابقة التكعيب",
        view_leaderboard: "عرض لوحة الصدارة",
        admin_panel_title: "لوحة تحكم المسؤول",
        round_status_title: "التحكم في حالة الجولة",
        current_status_label: "الحالة الحالية:",
        update_status_btn: "تحديث الحالة",
        competitor_management_title: "إدارة المتسابقين",
        add_competitor_btn: "إضافة متسابق جديد",
        existing_competitors_title: "المتسابقون الحاليون",
        add_results_btn: "إضافة نتائج",
        delete_competitor_btn: "حذف",
        admin_login_prompt: "تسجيل دخول المسؤول مطلوب",
        login_btn: "تسجيل الدخول",
        // Add Competitor Page
        title_add_competitor: "إضافة متسابق - لوحة التحكم للمسؤول",
        back_to_admin: "العودة إلى لوحة التحكم",
        add_competitor_title: "إضافة متسابق جديد",
        competitor_name_label: "اسم المتسابق:",
        competitor_photo_label: "الصورة الشخصية:",
        submit_competitor_btn: "إضافة المتسابق",
        // Add Results Page
        title_add_results: "إضافة نتائج - لوحة التحكم للمسؤول",
        add_results_title: "إضافة نتائج",
        adding_results_for: "إضافة نتائج لـ: ",
        enter_solves_label: "أدخل 5 محاولات (استخدم 'DNF' للمحاولة غير المكتملة):",
        calculated_ao5_label: "متوسط الخمسة المحسوب:",
        ao5_calculating: "جاري الحساب...",
        submit_results_btn: "إرسال النتائج",
        // JS Messages
        status_updated: "تم تحديث الحالة بنجاح!",
        status_update_failed: "فشل تحديث الحالة.",
        competitor_added: "تمت إضافة المتسابق بنجاح!",
        competitor_add_failed: "فشل إضافة المتسابق.",
        results_added: "تمت إضافة النتائج بنجاح!",
        results_add_failed: "فشل إضافة النتائج.",
        competitor_deleted: "تم حذف المتسابق بنجاح!",
        competitor_delete_failed: "فشل حذف المتسابق.",
        confirm_delete: "هل أنت متأكد أنك تريد حذف هذا المتسابق؟",
        login_failed: "فشل تسجيل الدخول. يرجى المحاولة مرة أخرى.",
        logout_btn: "تسجيل الخروج",
        invalid_time_format: "تنسيق الوقت غير صالح. استخدم الثواني (مثل 12.34) أو DNF.",
        need_5_solves: "الرجاء إدخال 5 محاولات بالضبط.",
        photo_upload_failed: "فشل تحميل الصورة.",
        photo_uploaded: "تم تحميل الصورة بنجاح.",
        fetching_data: "جاري جلب البيانات...",
        no_competitors: "لم يتم إضافة أي متسابقين بعد.",
        no_results: "لا توجد نتائج بعد."
    }
};

let currentLang = localStorage.getItem('language') || 'en';

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
    document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';

    document.querySelectorAll('[data-lang]').forEach(element => {
        const key = element.getAttribute('data-lang');
        if (translations[lang] && translations[lang][key]) {
            // Handle specific elements like input placeholders
            if (element.tagName === 'INPUT' && element.placeholder) {
                element.placeholder = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // Update button text explicitly if needed (e.g., the language switch button itself)
    const langSwitchButton = document.getElementById('lang-switch');
    if (langSwitchButton) {
        langSwitchButton.textContent = translations[lang]['switch_language'];
    }

    // Special handling for responsive table headers
    if (document.querySelector('#leaderboard td')) {
        updateResponsiveTableHeaders(lang);
    }
}

function updateResponsiveTableHeaders(lang) {
    // Update data-label attributes for responsive table view
    const headers = translations[lang];
    document.querySelectorAll('#leaderboard tbody tr').forEach(row => {
        const rankCell = row.querySelector('td:nth-child(1)');
        const nameCell = row.querySelector('td:nth-child(2)');
        const avgCell = row.querySelector('td:nth-child(3)');
        const solvesCell = row.querySelector('td:nth-child(4)');

        if(rankCell) rankCell.setAttribute('data-label', headers.rank);
        if(nameCell) nameCell.setAttribute('data-label', headers.name);
        if(avgCell) avgCell.setAttribute('data-label', headers.average);
        if(solvesCell) solvesCell.setAttribute('data-label', headers.solves);
    });
}

function getText(key) {
    return translations[currentLang][key] || key; // Return key if translation not found
}

document.addEventListener('DOMContentLoaded', () => {
    const langSwitchButton = document.getElementById('lang-switch');
    if (langSwitchButton) {
        langSwitchButton.addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'ar' : 'en';
            setLanguage(newLang);
        });
    }

    // Set initial language
    setLanguage(currentLang);
});

